import ht from"exceljs";import xt from"fs";import{jsPDF as lt}from"jspdf";function _(t,a,o,s,c,m){if(!m)return;["top","left","bottom","right"].forEach(A=>{var Y;let j=m[A];if(j&&j.style&&j.style.toLowerCase()!=="none"){let b=(Y=j.color)!=null&&Y.argb?`#${j.color.argb.slice(2)}`:"#000000";switch(t.setDrawColor(b),t.setLineWidth(1),A){case"top":t.line(a,o,a+s,o);break;case"left":t.line(a,o,a,o+c);break;case"bottom":t.line(a,o+c,a+s,o+c);break;case"right":t.line(a+s,o,a+s,o+c);break}}})}function tt(t,a){let o="";for(;a>0;){let s=(a-1)%26;o=String.fromCharCode(65+s)+o,a=Math.floor((a-1)/26)}return`${o}${t}`}function et(t){let a=t.match(/^([A-Z]+)(\d+)$/);if(!a)throw new Error(`Invalid cell reference: ${t}`);let o=a[1],s=parseInt(a[2],10),c=0;for(let m=0;m<o.length;m++)c*=26,c+=o.charCodeAt(m)-64;return{row:s,col:c}}function at(t,a=2){if(t.value==null)return"";if(typeof t.value=="object"){if(t.value.result!==void 0){let o=t.value.result;if(typeof o=="number"){let s=t.numFmt||"";if(s.includes("0.00")||s.includes("#.##")||s.includes("0.0")){let c=s.match(/\.0+/),m=c?c[0].length-1:a;return o.toFixed(m)}return o%1!==0,o.toString()}return String(o)}return t.value.richText&&Array.isArray(t.value.richText)?t.value.richText.map(o=>o.text||"").join(""):t.value.hyperlink&&t.value.text||t.value.text?t.value.text:t.value.formula?t.value.error?`#${t.value.error.toUpperCase()}`:t.text&&t.text!==""?t.text:`=${t.value.formula}`:t.value.sharedFormula?t.text&&t.text!==""?t.text:"0":(Object.keys(t.value).length===0,"")}if(typeof t.value=="number")try{let o=t.numFmt||"";if(o.includes("0.00")||o.includes("#.##")||o.includes("0.0")){let s=o.match(/\.0+/),c=s?s[0].length-1:a;return t.value.toFixed(c)}return t.text&&t.text.includes(".")&&!t.text.startsWith("=")&&!t.text.includes("(")?t.text:(t.value%1!==0,t.value.toString())}catch{return String(t.value)}if(t.text&&t.text!=="")return t.text;if(typeof t.value=="string"&&t.value.match(/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}\.\d{3}Z$/))try{return new Date(t.value).toLocaleDateString()}catch{return t.value}return String(t.value)}async function Pt({inputFilePath:t,outputFilePath:a,enablePagination:o=!1,MAX_WIDTH_SIZE:s=14400,MAX_HEIGHT_SIZE:c=14400,MIN_WIDTH_SIZE:m=612,MIN_HEIGHT_SIZE:O=792,useMinLimit:A=!1,fixedAt:j=2}){if(!xt.existsSync(t))throw new Error(`Error: The file "${t}" was not found.`);let Y=new ht.Workbook;try{await Y.xlsx.readFile(t);let b=Y.getWorksheet(1),X=[],ot=b.rowCount,rt=b.columnCount,S={};b._merges&&Object.entries(b._merges).forEach(([f,r])=>{let{top:n,left:e,bottom:i,right:u}=r.model;for(let d=n;d<=i;d++)for(let g=e;g<=u;g++)S[`${d}-${g}`]={range:`${n}-${e}:${i}-${u}`,startRow:n,startCol:e,endRow:i,endCol:u}});for(let f=1;f<=ot;f++){let r=b.getRow(f),n=[];for(let e=1;e<=rt;e++){let i=`${f}-${e}`;if(S[i]&&(f!==S[i].startRow||e!==S[i].startCol)){n.push({text:"",style:{},mergeInfo:null,isSecondaryMergeCell:!0});continue}let u=r.getCell(e),d=at(u,j),g=u.style||{},C=null;S[i]&&(C=S[i]),n.push({text:d,style:g,mergeInfo:C})}X.push(n)}Object.entries(S).forEach(([f,r])=>{let n=tt(r.startRow,r.startCol),e=tt(r.endRow,r.endCol);r.range=`${n}:${e}`});let ft=12,$=20,Z=new lt({unit:"pt",format:"a4"}),N=10,ct=10,p=Array(rt).fill(N);X.forEach(f=>{f.forEach((r,n)=>{var g,C,L,U,B;if(r.isSecondaryMergeCell)return;let e=r.text||"",i=((g=r.style.font)==null?void 0:g.size)||ft,u="normal";(C=r.style.font)!=null&&C.bold&&((L=r.style.font)!=null&&L.italic)?u="bolditalic":(U=r.style.font)!=null&&U.bold?u="bold":(B=r.style.font)!=null&&B.italic&&(u="italic"),Z.setFont("helvetica",u),Z.setFontSize(i);let d=Z.getTextWidth(e)+N+ct;if(r.mergeInfo){let{startCol:k,endCol:z}=r.mergeInfo,T=p.slice(k-1,z).reduce((J,q)=>J+q,0);if(T<d){let J=d-T,q=z-k+1,M=J/q;for(let K=k-1;K<z;K++)p[K]+=M}}else d>p[n]&&(p[n]=d)})});let ut=p.reduce((f,r)=>f+r,0),dt=ot*$+10,F=50,h=ut+F*2,y=dt+F*2+40;A&&(h<m&&(h=m,console.log(`Page width increased to minimum: ${m} units`)),y<O&&(y=O,console.log(`Page height increased to minimum: ${O} units`))),(h>s||y>c)&&(y>c&&!o?(console.warn("Document height too large, enabling pagination automatically"),o=!0,h>s&&(h=s,console.log(`Table width capped at ${s} units for jsPDF compatibility`)),y=O):h>s&&y<=c&&!o?(h=s,console.log(`Table width capped at ${s} units for jsPDF compatibility`)):o&&(h>s&&(h=s,console.log(`Table width capped at ${s} units for jsPDF compatibility`)),y=O),console.log(`Final page dimensions: ${h}x${y}`));let nt=[];b.getImages().forEach(f=>{let r=f.range,n=r.ext,e=r==null?void 0:r.tl;if(!e||e.col==null||e.row==null)return;let i=Y.getImage(f.imageId);i!=null&&i.buffer&&nt.push({buffer:i.buffer,ext:n,tl:e})});let l=new lt({orientation:h>y?"landscape":"portrait",unit:"pt",format:[h,y]});nt.forEach(({tl:f,ext:r,buffer:n})=>{try{let e=f.nativeCol||0,i=f.nativeRow||0,u=F+p.slice(0,e).reduce((k,z)=>k+z,0),d=F+i*$,g=.75,C=((r==null?void 0:r.width)||0)*g,L=((r==null?void 0:r.height)||0)*g,B=`data:image/png;base64,${n.toString("base64")}`;l.addImage(B,"PNG",u,d,C,L)}catch(e){console.warn("Could not add image:",e.message)}});let v=F,gt=F;X.forEach((f,r)=>{let n=gt;o&&v+$>y-F&&(l.addPage(),v=F),f.forEach((e,i)=>{var L,U,B,k,z,T,J,q,M,K,st,it;let u=!1,d=!1,g=1,C=1;if(e.mergeInfo){let[x,R]=e.mergeInfo.range.split(":"),w=et(x),P=et(R);g=P.col-w.col+1,C=P.row-w.row+1,u=!0,r+1===w.row&&i+1===w.col&&(d=!0)}if(u&&!d){n+=p[i]||60+N;return}if(u&&d){let x=p.slice(i,i+g).reduce((I,mt)=>I+mt,0),R=$*C;if(e.style.fill&&e.style.fill.fgColor&&e.style.fill.fgColor.argb){let I=e.style.fill.fgColor.argb.slice(2);l.setFillColor(`#${I}`),l.rect(n,v,x,R,"F")}let w=((L=e.style.font)==null?void 0:L.size)||12,P=(U=e.style.font)==null?void 0:U.bold,W=(B=e.style.font)==null?void 0:B.italic,Q="normal";P&&W?Q="bolditalic":P?Q="bold":W&&(Q="italic"),l.setFont("helvetica",Q),l.setFontSize(w);let E=(z=(k=e.style.font)==null?void 0:k.color)!=null&&z.argb?`#${e.style.font.color.argb.slice(2)}`:"#000000";l.setTextColor(E);let V=e.text||"",D=((T=e.style.alignment)==null?void 0:T.horizontal)||"left",G=v+R/2+w/3;D==="center"?l.text(V,n+x/2,G,{align:"center"}):D==="right"?l.text(V,n+x-2,G,{align:"right"}):l.text(V,n+2,G);let H=e.style.border||{};_(l,n,v,x,R,H),n+=p[i]||60+N}else{let x=p[i]||60+N;if(e.style.fill&&e.style.fill.fgColor&&e.style.fill.fgColor.argb){let H=e.style.fill.fgColor.argb.slice(2);l.setFillColor(`#${H}`),l.rect(n,v,x,$,"F")}let R=((J=e.style.font)==null?void 0:J.size)||12,w=(q=e.style.font)==null?void 0:q.bold,P=(M=e.style.font)==null?void 0:M.italic,W="normal";w&&P?W="bolditalic":w?W="bold":P&&(W="italic"),l.setFont("helvetica",W),l.setFontSize(R);let Q=(st=(K=e.style.font)==null?void 0:K.color)!=null&&st.argb?`#${e.style.font.color.argb.slice(2)}`:"#000000";l.setTextColor(Q);let E=e.text||"",V=((it=e.style.alignment)==null?void 0:it.horizontal)||"left",D=v+$/2+R/3;V==="center"?l.text(E,n+x/2,D,{align:"center"}):V==="right"?l.text(E,n+x-2,D,{align:"right"}):l.text(E,n+2,D);let G=e.style.border||{};_(l,n,v,x,$,G),n+=x}}),v+=$}),l.save(a)}catch(b){throw new Error(`Error processing Excel file: ${b.message}`)}}export{Pt as convertExcelToPdf};
//# sourceMappingURL=excel-to-pdf.js.map
